(()=>{"use strict";var e=["inputSelector","submitButtonSelector"],t=["formSelector"];function o(e,t){if(null==e)return{};var o,n,r=function(e,t){if(null==e)return{};var o,n,r={},a=Object.keys(e);for(n=0;n<a.length;n++)o=a[n],t.indexOf(o)>=0||(r[o]=e[o]);return r}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(n=0;n<a.length;n++)o=a[n],t.indexOf(o)>=0||Object.prototype.propertyIsEnumerable.call(e,o)&&(r[o]=e[o])}return r}var n=document.forms,r=function(e){return e.some((function(e){return!e.validity.valid}))},a=function(e,t){r(e)?t.disabled=!0:t.disabled=!1},c={profileName:document.querySelector(".profile__name"),profileInfo:document.querySelector(".profile__info"),avatarImg:document.querySelector(".profile__avatar-img")},u={editProfileBtn:document.querySelector(".profile__edit-button"),addElementBtn:document.querySelector(".profile__add-button")},i={do:"Сохранить",doing:"Сохранение..."},l={do:"Cоздать",doing:"Создание..."};function s(e){e.classList.add("popup_opened"),function(e){e.addEventListener("click",k),e.addEventListener("click",q),document.addEventListener("keydown",b)}(e)}function p(e){e.classList.remove("popup_opened"),function(e){e.removeEventListener("click",k),e.removeEventListener("click",q),document.removeEventListener("keydown",b)}(e)}function d(e,t,o){var n=e.querySelector(".form__button");o?n.textContent=t.doing:(n.textContent=t.do,p(e))}var f={baseUrl:"https://nomoreparties.co/v1/plus-cohort7",headers:{authorization:"a34ef1b9-3d1d-4a73-a9bd-379580b0d476","Content-Type":"application/json"},userId:""},m=new Promise((function(e,t){return fetch("".concat(f.baseUrl,"/users/me"),{headers:f.headers}).then((function(o){o.ok&&e(o.json()),t("Ошибка: ".concat(o.status))}))})),v=new Promise((function(e,t){return fetch("".concat(f.baseUrl,"/cards"),{headers:f.headers}).then((function(o){o.ok&&e(o.json()),t("Ошибка: ".concat(o.status))}))})),_=document.querySelector(".elements"),y=document.querySelector(".elements__template").content;function h(e){var t=e._id,o=y.querySelector(".element").cloneNode(!0);o.querySelector(".element__image").src=e.link,o.querySelector(".element__image").alt=e.name,o.querySelector(".element__title").textContent=e.name,e.owner._id!==f.userId&&(o.querySelector(".element__trash").style.display="none"),o.querySelector(".element__trash").addEventListener("click",(function(){!function(e){fetch("".concat(f.baseUrl,"/cards/").concat(e),{method:"DELETE",headers:f.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(e){console.log(e)})).catch((function(e){console.log(e)}))}(t),o.remove()}));var n=o.querySelector(".element__like-button"),r=o.querySelector(".element__like-count");return r.textContent=e.likes.length,e.likes.forEach((function(e){e._id===f.userId&&n.classList.add("element__like-button_active")})),n.addEventListener("click",(function(){n.classList.contains("element__like-button_active")?(n.classList.remove("element__like-button_active"),r.textContent=+r.textContent-1,function(e){fetch("".concat(f.baseUrl,"/cards/likes/").concat(e),{method:"DELETE",headers:f.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(e){console.log(e)})).catch((function(e){console.log(e)}))}(t)):(n.classList.add("element__like-button_active"),r.textContent=+r.textContent+1,function(e){fetch("".concat(f.baseUrl,"/cards/likes/").concat(e),{method:"PUT",headers:f.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(e){console.log(e)})).catch((function(e){console.log(e)}))}(t))})),o.querySelector(".element__image").addEventListener("click",(function(){g.popupImage.src=o.querySelector(".element__image").src,g.popupImage.alt=o.querySelector(".element__title").textContent,g.popupPlaceName.textContent=o.querySelector(".element__title").textContent,s(g.imgPopup)})),o}var S,g={editPopup:document.querySelector("#popup_edit-profile"),addPopup:document.querySelector("#popup_add-element"),deletePopup:document.querySelector("#popup_delete-element"),avatarPopup:document.querySelector("#popup_edit-avatar"),imgPopup:document.querySelector("#popup_element-image"),popupImage:document.querySelector(".popup__image"),popupPlaceName:document.querySelector(".popup__place-name"),avatarLinkPopup:document.querySelector('[name="avatar-link"]'),profileNamePopup:document.querySelector('[name="profile-name"]'),profileInfoPopup:document.querySelector('[name="profile-info"]'),imgLink:document.querySelector('[name="image-link"]'),placeName:document.querySelector('[name="place-name"]')};function P(e){var t=Array.from(e.querySelectorAll(".form__input")),o=Array.from(e.querySelectorAll(".form__input-error")),n=e.querySelector(".form__button");t.forEach((function(e){e.classList.contains("form__input_type_error")&&e.classList.remove("form__input_type_error")})),o.forEach((function(e){e.classList.contains("form__input-error_active")&&e.classList.remove("form__input-error_active")})),r(t),a(t,n)}function k(e){e.target.classList.contains("popup")&&p(e.currentTarget)}function q(e){e.target.classList.contains("popup__close")&&p(e.currentTarget)}function b(e){"Escape"===e.key&&document.querySelector(".popup_opened")&&p(document.querySelector(".popup_opened"))}function L(e,t){e.querySelector(".form").addEventListener("submit",t)}S=o({formSelector:".form",inputSelector:".form__input",submitButtonSelector:".form__button",inputErrorClass:"form__input_type_error",errorClass:"form__input-error_active"},t),Array.from(n).forEach((function(t){t.addEventListener("submit",(function(e){e.preventDefault()})),function(t,n){var r=n.inputSelector,c=n.submitButtonSelector,u=o(n,e),i=Array.from(t.querySelectorAll(r)),l=t.querySelector(c);a(i,l),i.forEach((function(e){e.addEventListener("input",(function(){!function(e,t,o){t.validity.valid?function(e,t,o){var n=o.inputErrorClass,r=o.errorClass,a=e.querySelector(".".concat(t.id,"-error"));t.classList.remove(n),a.classList.remove(r),a.textContent=""}(e,t,o):function(e,t,o,n){var r=n.inputErrorClass,a=n.errorClass,c=e.querySelector(".".concat(t.id,"-error"));t.classList.add(r),c.textContent=o,c.classList.add(a)}(e,t,t.validationMessage,o)}(t,e,u),a(i,l)}))}))}(t,S)})),Promise.all([m,v]).then((function(e){var t;t=e[0],c.avatarImg.src=t.avatar,c.profileName.textContent=t.name,c.profileInfo.textContent=t.about,f.userId=e[0]._id,e[1].forEach((function(e){var t=h(e);_.append(t)}))})).catch((function(e){console.log(e)})).finally((function(){document.querySelector(".page").classList.add("page_visible")})),u.editProfileBtn.addEventListener("click",(function(){g.profileNamePopup.value=c.profileName.textContent,g.profileInfoPopup.value=c.profileInfo.textContent,s(g.editPopup),P(g.editPopup)})),u.addElementBtn.addEventListener("click",(function(){g.imgLink.value="",g.placeName.value="",s(g.addPopup),P(g.addPopup)})),c.avatarImg.addEventListener("click",(function(){g.avatarLinkPopup.value="",s(g.avatarPopup),P(g.avatarPopup)})),L(g.editPopup,(function(e){var t,o,n;e.preventDefault(),""!==g.profileNamePopup.value&&""!==g.profileInfoPopup.value&&(c.profileName.textContent=g.profileNamePopup.value,c.profileInfo.textContent=g.profileInfoPopup.value,t=g.editPopup,o=g.profileNamePopup.value,n=g.profileInfoPopup.value,fetch("".concat(f.baseUrl,"/users/me"),{method:"PATCH",headers:f.headers,body:JSON.stringify({name:o,about:n})}).then((function(e){return e.ok?(d(t,i,!0),e.json()):Promise.reject("Ошибка: ".concat(e.status))})).then((function(e){console.log(e)})).catch((function(e){console.log(e)})).finally((function(){return d(t,i,!1)})))})),L(g.addPopup,(function(e){var t,o,n;e.preventDefault(),""!==g.imgLink.value&&""!==g.placeName.value&&(t=g.addPopup,o=g.placeName.value,n=g.imgLink.value,fetch("".concat(f.baseUrl,"/cards"),{method:"POST",headers:f.headers,body:JSON.stringify({name:o,link:n})}).then((function(e){return e.ok?(d(t,l,!0),e.json()):Promise.reject("Ошибка: ".concat(e.status))})).then((function(e){var t;console.log(e),t=h(e),_.prepend(t)})).catch((function(e){console.log(e)})).finally((function(){return d(t,l,!1)})))})),L(g.avatarPopup,(function(e){var t,o;e.preventDefault(),c.avatarImg.src=g.avatarLinkPopup.value,t=g.avatarPopup,o=g.avatarLinkPopup.value,fetch("".concat(f.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:f.headers,body:JSON.stringify({avatar:o})}).then((function(e){return e.ok?(d(t,i,!0),e.json()):Promise.reject("Ошибка: ".concat(e.status))})).then((function(e){console.log(e)})).catch((function(e){console.log(e)})).finally((function(){return d(t,i,!1)}))}))})();