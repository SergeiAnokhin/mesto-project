(()=>{"use strict";var e=["inputSelector","submitButtonSelector"],t=["formSelector"];function n(e,t){if(null==e)return{};var n,o,r=function(e,t){if(null==e)return{};var n,o,r={},a=Object.keys(e);for(o=0;o<a.length;o++)n=a[o],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(o=0;o<a.length;o++)n=a[o],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var o,r=document.forms,a=function(e){return e.some((function(e){return!e.validity.valid}))},c=function(e,t){a(e)?t.disabled=!0:t.disabled=!1},u={profileName:document.querySelector(".profile__name"),profileInfo:document.querySelector(".profile__info"),avatarImg:document.querySelector(".profile__avatar-img")},i={editProfileBtn:document.querySelector(".profile__edit-button"),addElementBtn:document.querySelector(".profile__add-button")},l={do:"Сохранить",doing:"Сохранение..."},p={do:"Cоздать",doing:"Создание..."},s={},d=function(e){e.classList.add("popup_opened"),q(e)},f=function(e){e.classList.remove("popup_opened"),E(e)},m=function(e,t,n){e.querySelector(".form__button").textContent=n?t.doing:t.do},v={baseUrl:"https://nomoreparties.co/v1/plus-cohort7",headers:{authorization:"a34ef1b9-3d1d-4a73-a9bd-379580b0d476","Content-Type":"application/json"}},_=function(e){return e.ok?e.json():Promise.reject("Ошибка ".concat(e.status))},h=document.querySelector(".elements"),y=document.querySelector(".elements__template").content,S=function(e,t){var n=e._id,o=y.querySelector(".element").cloneNode(!0),r=o.querySelector(".element__image"),a=o.querySelector(".element__title"),c=o.querySelector(".element__trash");r.src=e.link,r.alt=e.name,a.textContent=e.name,e.owner._id!==t&&(c.style.display="none"),c.addEventListener("click",(function(){(function(e){return fetch("".concat(v.baseUrl,"/cards/").concat(e),{method:"DELETE",headers:v.headers}).then((function(e){return _(e)}))})(n).then((function(){o.remove()})).catch((function(e){console.log(e)}))}));var u=o.querySelector(".element__like-button"),i=o.querySelector(".element__like-count");return i.textContent=e.likes.length,e.likes.forEach((function(e){e._id===t&&u.classList.add("element__like-button_active")})),u.addEventListener("click",(function(){u.classList.contains("element__like-button_active")?function(e){return fetch("".concat(v.baseUrl,"/cards/likes/").concat(e),{method:"DELETE",headers:v.headers}).then((function(e){return _(e)}))}(n).then((function(e){u.classList.remove("element__like-button_active"),i.textContent=e.likes.length})).catch((function(e){console.log(e)})):function(e){return fetch("".concat(v.baseUrl,"/cards/likes/").concat(e),{method:"PUT",headers:v.headers}).then((function(e){return _(e)}))}(n).then((function(e){u.classList.add("element__like-button_active"),i.textContent=e.likes.length})).catch((function(e){console.log(e)}))})),r.addEventListener("click",(function(){P.popupImage.src=e.link,P.popupImage.alt=e.name,P.popupPlaceName.textContent=e.name,d(P.imgPopup)})),o},P={editPopup:document.querySelector("#popup_edit-profile"),addPopup:document.querySelector("#popup_add-element"),deletePopup:document.querySelector("#popup_delete-element"),avatarPopup:document.querySelector("#popup_edit-avatar"),imgPopup:document.querySelector("#popup_element-image"),popupImage:document.querySelector(".popup__image"),popupPlaceName:document.querySelector(".popup__place-name"),avatarLinkPopup:document.querySelector('[name="avatar-link"]'),profileNamePopup:document.querySelector('[name="profile-name"]'),profileInfoPopup:document.querySelector('[name="profile-info"]'),imgLink:document.querySelector('[name="image-link"]'),placeName:document.querySelector('[name="place-name"]')},g=function(e){var t=Array.from(e.querySelectorAll(".form__input")),n=Array.from(e.querySelectorAll(".form__input-error")),o=e.querySelector(".form__button");t.forEach((function(e){e.classList.contains("form__input_type_error")&&e.classList.remove("form__input_type_error")})),n.forEach((function(e){e.classList.contains("form__input-error_active")&&e.classList.remove("form__input-error_active")})),a(t),c(t,o)},b=function(e){e.target.classList.contains("popup")&&f(e.currentTarget)},L=function(e){e.target.classList.contains("popup__close")&&f(e.currentTarget)},k=function(e){if("Escape"===e.key){var t=document.querySelector(".popup_opened");t&&f(t)}},q=function(e){e.addEventListener("click",b),e.addEventListener("click",L),document.addEventListener("keydown",k)},E=function(e){e.removeEventListener("click",b),e.removeEventListener("click",L),document.removeEventListener("keydown",k)},C=function(e,t){e.querySelector(".form").addEventListener("submit",t)},N=Promise.all([fetch("".concat(v.baseUrl,"/users/me"),{headers:v.headers}).then((function(e){return _(e)})),fetch("".concat(v.baseUrl,"/cards"),{headers:v.headers}).then((function(e){return _(e)}))]);o=n({formSelector:".form",inputSelector:".form__input",submitButtonSelector:".form__button",inputErrorClass:"form__input_type_error",errorClass:"form__input-error_active"},t),Array.from(r).forEach((function(t){t.addEventListener("submit",(function(e){e.preventDefault()})),function(t,o){var r=o.inputSelector,a=o.submitButtonSelector,u=n(o,e),i=Array.from(t.querySelectorAll(r)),l=t.querySelector(a);c(i,l),i.forEach((function(e){e.addEventListener("input",(function(){!function(e,t,n){t.validity.valid?function(e,t,n){var o=n.inputErrorClass,r=n.errorClass,a=e.querySelector(".".concat(t.id,"-error"));t.classList.remove(o),a.classList.remove(r),a.textContent=""}(e,t,n):function(e,t,n,o){var r=o.inputErrorClass,a=o.errorClass,c=e.querySelector(".".concat(t.id,"-error"));t.classList.add(r),c.textContent=n,c.classList.add(a)}(e,t,t.validationMessage,n)}(t,e,u),c(i,l)}))}))}(t,o)})),N.then((function(e){var t,n,o;s.id=e[0]._id,t=e[0],u.avatarImg.src=t.avatar,u.profileName.textContent=t.name,u.profileInfo.textContent=t.about,n=e[1],o=s.id,n.forEach((function(e){var t=S(e,o);h.append(t)}))})).catch((function(e){console.log(e)})).finally((function(){document.querySelector(".page").classList.add("page_visible")})),i.editProfileBtn.addEventListener("click",(function(){P.profileNamePopup.value=u.profileName.textContent,P.profileInfoPopup.value=u.profileInfo.textContent,d(P.editPopup),g(P.editPopup)})),i.addElementBtn.addEventListener("click",(function(){P.imgLink.value="",P.placeName.value="",d(P.addPopup),g(P.addPopup)})),u.avatarImg.addEventListener("click",(function(){P.avatarLinkPopup.value="",d(P.avatarPopup),g(P.avatarPopup)})),C(P.editPopup,(function(e){var t,n;e.preventDefault(),""!==P.profileNamePopup.value&&""!==P.profileInfoPopup.value&&(m(P.editPopup,l,!0),(t=P.profileNamePopup.value,n=P.profileInfoPopup.value,fetch("".concat(v.baseUrl,"/users/me"),{method:"PATCH",headers:v.headers,body:JSON.stringify({name:t,about:n})}).then((function(e){return _(e)}))).then((function(e){u.profileName.textContent=e.name,u.profileInfo.textContent=e.about,f(P.editPopup)})).catch((function(e){console.log(e)})).finally((function(){return m(P.editPopup,l,!1)})))})),C(P.addPopup,(function(e){var t,n;e.preventDefault(),m(P.addPopup,p,!0),""!==P.imgLink.value&&""!==P.placeName.value&&(t=P.placeName.value,n=P.imgLink.value,fetch("".concat(v.baseUrl,"/cards"),{method:"POST",headers:v.headers,body:JSON.stringify({name:t,link:n})}).then((function(e){return _(e)}))).then((function(e){var t,n,o;t=e,n=s.id,o=S(t,n),h.prepend(o),f(P.addPopup)})).catch((function(e){console.log(e)})).finally((function(){return m(P.addPopup,p,!1)}))})),C(P.avatarPopup,(function(e){var t;e.preventDefault(),m(P.avatarPopup,l,!0),(t=P.avatarLinkPopup.value,fetch("".concat(v.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:v.headers,body:JSON.stringify({avatar:t})}).then((function(e){return _(e)}))).then((function(e){u.avatarImg.src=e.avatar,f(P.avatarPopup)})).catch((function(e){console.log(e)})).finally((function(){return m(P.avatarPopup,l,!1)}))}))})();